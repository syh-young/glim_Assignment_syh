# GLIM MFC Assignment (정원 그리기)

MFC Dialog 기반으로 **3개 클릭 지점 원 + 세 점을 지나는 정원(외접원)** 을 그리고,  
**드래그 실시간 갱신**, **초기화**, **랜덤 이동(0.5초 간격 10회 자동)** 을 구현한 과제입니다.

---

## 요구사항 체크리스트

- [x] 3번째 클릭 이후, 클릭 지점 3개를 모두 지나는 정원 1개를 그린다.
- [x] 클릭 지점 원의 반지름은 사용자 입력(Edit)으로 받는다.
- [x] 각 클릭 지점 원의 중심 좌표를 UI에 표시한다.
- [x] 4번째 클릭부터는 클릭 지점 원을 그리지 않는다.
- [x] 정원 내부는 채우지 않고(테두리만), 테두리 두께는 사용자 입력(Edit)으로 받는다.
- [x] 클릭 지점 3개 중 하나를 클릭 후 드래그하면 정원을 다시 그린다.
- [x] 드래그 중 마우스 좌표가 바뀌는 동안 정원이 실시간으로 계속 갱신된다.
- [x] [초기화] 버튼을 누르면 모든 내용을 삭제하고 처음 상태로 되돌린다.
- [x] [랜덤 이동] 버튼을 누르면 3개의 클릭 지점 원이 랜덤 위치로 이동하고 정원이 다시 그려진다.
- [x] 랜덤 이동/정원 재그리기 동작을 **초당 2회(0.5초 간격), 총 10회 자동 반복**하며 UI가 멈추지 않도록 **별도 쓰레드로 구현**한다.
- [x] MFC Dialog 기반 프로젝트
- [x] 금지 API 미사용: `wingdi`, `gdiplus`, `Ellipse`류, `FillPolygon`, `DrawPolygon` 등

---

## 실행 방법

1. Visual Studio에서 솔루션(`.sln`)을 열고 빌드/실행합니다.
2. UI에서 다음을 입력합니다.
   - 점 반지름(Edit): `IDC_EDIT_POINT_R`
   - 정원 두께(Edit): `IDC_EDIT_CIRCLE_THICK`
3. 캔버스(Static Picture Control)에서 마우스로 점을 찍고/드래그합니다.

---

## 조작 흐름(기능 설명)

### 1) 점 찍기 (1~3번째 클릭)
- 캔버스를 클릭하면 클릭 좌표가 저장되고 `p1, p2, p3` 라벨이 업데이트됩니다.
- 1번째~3번째 클릭까지는 **검정 점(원)** 이 그려집니다.
- 3점이 모이면 그 3점을 지나는 **정원(외접원)** 을 계산/표시합니다.
- 4번째 클릭부터는 추가 점을 받지 않습니다(무시).

### 2) 정원(외접원) 계산
- 3점이 일직선(Collinear)이면 외접원 계산이 불가능하므로 정원을 생성하지 않습니다.
- 외접원 중심과 반지름은 3점의 외접원 공식을 이용하여 계산합니다.

### 3) 점(원) 표시 방식
- 금지된 도형 API를 사용하지 않고, 아래 방식으로 원을 구현합니다.
  - 외곽선: `MoveTo/LineTo`로 다각형 근사(Polyline circle)
  - 내부 채움: y 스캔라인 방식으로 `LineTo` 반복(검정 점처럼 보이도록)

### 4) 드래그로 점 이동 + 실시간 갱신
- 정원이 그려진 상태(점 3개 존재)에서 점(원)을 클릭하면 **어떤 점을 잡았는지 판별(HitTest)** 하여 드래그 대상으로 지정합니다.
- 드래그 중에는 마우스 좌표 변화에 따라 해당 점의 좌표가 계속 갱신되고,
  - UI의 `p1/p2/p3` 좌표도 실시간으로 변경
  - 외접원도 즉시 재계산되어 다시 그려짐

### 5) [초기화] 버튼
- 클릭 카운트, 저장된 점 배열, 정원 상태를 모두 초기화합니다.
- UI의 `p1/p2/p3` 라벨을 `(-, -)`로 되돌립니다.
- 캔버스는 `ClearAll()`로 내부 상태를 초기화하고 다시 그립니다.

### 6) [랜덤 이동] 버튼 + 자동 10회 반복 (0.5초 간격)
- 정원이 그려진 상태에서 버튼을 누르면 3개의 점이 랜덤 위치로 이동합니다.
- 이동 후 정원도 다시 계산되어 그려집니다.
- 요구사항에 따라 **0.5초 간격으로 10회 자동 반복**되며,
  - UI 프리징(멈춤) 방지를 위해 **별도 쓰레드에서 반복 실행**
  - UI 업데이트는 메시지/핸들러 방식으로 메인 스레드에서 반영합니다.
- 랜덤 좌표 생성 시 원이 캔버스 밖으로 삐져나가지 않도록 margin을 적용합니다.
- 3점이 일직선이 되는 경우를 피하기 위해 재시도(최대 n회) 후 유효한 점으로 확정합니다.

---

## 코드 구조 요약

### `CanvasCtrl.h / CanvasCtrl.cpp`
- 캔버스 역할을 하는 `CStatic` 파생 컨트롤
- 담당 기능
  - 점(원) 그리기 + 내부 채움(스캔라인)
  - 정원(외접원) 계산 결과 표시
  - 점 클릭 판별(HitTest)
  - 드래그 처리(마우스 캡처 포함)
  - 드래그 중 좌표 변화 이벤트를 다이얼로그로 전달(`WM_CANVAS_POINT_MOVED`)
  - 클리핑(캔버스 영역 밖으로 그려지는 현상 방지)

핵심 메서드:
- `SetPoints3(const CPoint* pts, int count)` : 점 상태 반영 + 외접원 계산 + 다시 그리기
- `SetPointRadius(int r)` : 점 반지름 설정
- `SetGardenThick(int t)` : 정원 테두리 두께 설정
- `ClearAll()` : 캔버스 상태 초기화
- `HitTestPointIndex(CPoint pt)` : 어떤 점을 눌렀는지 판별

### `glim_syhDlg.cpp / glim_syhDlg.h`
- 다이얼로그(UI) 이벤트 처리 담당
- 담당 기능
  - 캔버스 클릭 좌표 수신(`WM_CANVAS_CLICK`) → `m_pts[]` 저장 → `p1/p2/p3` 업데이트
  - Edit 입력값(반지름/두께)을 읽어 캔버스에 적용
  - 드래그 중 점 이동 메시지 수신(`WM_CANVAS_POINT_MOVED`) → 좌표 표시 갱신 + 캔버스 재계산 요청
  - [초기화], [랜덤 이동] 버튼 처리
  - (요구사항) 랜덤 이동 10회 자동 반복을 쓰레드로 수행

---

## 금지 API 관련

요구사항의 금지 항목을 피하기 위해:
- 원: `Ellipse` 대신 `MoveTo/LineTo`로 원을 근사하여 그림
- 점 채움: `FillPolygon` 등의 채움 API 대신 스캔라인으로 직접 라인 채움
- GDI+ 미사용

---

## 스크린샷

`screenshot/` 폴더에 실행 화면을 첨부합니다.
- 1~3회 클릭 후 정원 생성
- 드래그로 점 이동 + 정원 실시간 갱신
- 랜덤 이동 동작

---

## 참고

본 구현은 MFC 기본 메시지 처리 방식(메인 UI 스레드) +  
랜덤 이동 반복 요구사항은 별도 쓰레드에서 수행하여 UI가 멈추지 않도록 구성했습니다.
